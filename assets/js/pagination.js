let products = [
  {
    id: "M1",
    title: "Cap Dragon",
    price: "$16.00",
    img: "assets/img/men/Cap_Dragon_Black_FRONT.jpg",
    size: "2X",
    color: "white",
    type: "hat",
  },
  {
    id: "M2",
    title: "Cap FH Black",
    price: "$20.00",
    img: "assets/img/men/Cap_FH_Black_00000348_FRONT.jpg",
    size: "S",
    color: "black",
    type: "hat",
  },
  {
    id: "M3",
    title: "Cap SpaceX Black",
    price: "$33.00",
    img: "assets/img/men/Cap_SpaceX_Black_0001082015_FRONT.jpg",
    size: "M",
    color: "black",
    type: "hat",
  },
  {
    id: "M4",
    title: "HEATSHIELD_HOODIE_MENS_MEDIUM_BACK",
    price: "$45.00",
    img: "assets/img/men/HEATSHIELD_HOODIE_MENS_MEDIUM_BACK.jpg",
    size: "M",
    color: "white",
    type: "tshirt",
  },
  {
    id: "M5",
    title: "MENS-43-POLO-T-SHIRT-BLACK-FRONT",
    price: "$30.00",
    img: "assets/img/men/MENS-43-POLO-T-SHIRT-BLACK-FRONT.jpg",
    size: "S",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M6",
    title: "MENS-CREW-DRAGONSCHEMATIC-CHARCOAL",
    price: "$67.00",
    img: "assets/img/men/MENS-CREW-DRAGONSCHEMATIC-CHARCOAL-BACK.jpg",
    size: "S",
    color: "grey",
    type: "tshirt",
  },
  {
    id: "M7",
    title: "MENS-DRAGON-HEATHERGRAY-BACK",
    price: "$98",
    img: "assets/img/men/MENS-DRAGON-HEATHERGRAY-BACK.jpg",
    size: "M",
    color: "white",
    type: "tshirt",
  },
  {
    id: "M8",
    title: "MENS-F9-T-SHIRT-BLACK-BACK",
    price: "$25.00",
    img: "assets/img/men/MENS-F9-T-SHIRT-BLACK-BACK.jpg",
    size: "L",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M9",
    title: "MENS-FALCON-HEAVY-CHARCOAL-BACK",
    price: "$62",
    img: "assets/img/men/MENS-FALCON-HEAVY-CHARCOAL-BACK.jpg",
    size: "2XL",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M10",
    title: "MENS-NUKEMARS-CHARCOAL-FRONT",
    price: "$32.00",
    img: "assets/img/men/MENS-NUKEMARS-CHARCOAL-FRONT.jpg",
    size: "3XL",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M11",
    title: "MENS-oocupymars-black-FRONT",
    price: "$19.00",
    img: "assets/img/men/MENS-oocupymars-black-FRONT.jpg",
    size: "M",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M12",
    title: "MENS-SPACEXLOGO-HEATHERGRAY-BACK",
    price: "$55",
    img: "assets/img/men/MENS-SPACEXLOGO-HEATHERGRAY-BACK.jpg",
    size: "L",
    color: "white",
    type: "tshirt",
  },
  {
    id: "M13",
    title: "MENS-starman-black-FRONT",
    price: "$74.00",
    img: "assets/img/men/MENS-starman-black-FRONT.jpg",
    size: "3XL",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M14",
    title: "MicrosoftTeams-image",
    price: "$33.00",
    img: "assets/img/men/MicrosoftTeams-image.jpg",
    size: "S",
    color: "white",
    type: "hat",
  },
  {
    id: "M15",
    title: "Mug_Occupy_Mars_SPXTERRAMUG_FRONT",
    price: "$25.00",
    img: "assets/img/men/Mug_Occupy_Mars_SPXTERRAMUG_FRONT.jpg",
    size: "15-oz",
    color: "white",
    type: "cup",
  },
  {
    id: "M16",
    title: "NewRBFFHandFairing_400x",
    price: "$65.00",
    img: "assets/img/men/NewRBFFHandFairing_400x.jpg",
    size: "3XL",
    color: "black",
    type: "chain",
  },
  {
    id: "M17",
    title: "RAPTOR_SCHEMATIC_SHIRT_MENS_LARGE_BACK",
    price: "$80.00",
    img: "assets/img/men/RAPTOR_SCHEMATIC_SHIRT_MENS_LARGE_BACK.jpg",
    size: "L",
    color: "brown",
    type: "tshirt",
  },
  {
    id: "M18",
    title: "SPACEX_0402230602",
    price: "$50.00",
    img: "assets/img/men/SPACEX_0402230602.jpg",
    size: "L",
    color: "grey",
    type: "tshirt",
  },
  {
    id: "M19",
    title: "SpaceX_Bottle_Front",
    price: "$14.00",
    img: "assets/img/men/SpaceX_Bottle_Front.jpg",
    size: "1L",
    color: "black",
    type: "bottle",
  },
  {
    id: "M20",
    title: "SPACEX_JOURNAL_front",
    price: "$56.00",
    img: "assets/img/men/SPACEX_JOURNAL_front.jpg",
    size: "5.25x8.25",
    color: "black",
    type: "journal",
  },
  {
    id: "M21",
    title: "StarshipStackPosterv2",
    price: "$22.00",
    img: "assets/img/men/StarshipStackPosterv2.jpg",
    size: "18x24",
    color: "grey",
    type: "poster",
  },
  {
    id: "M22",
    title: "STARSHIPTESTFLIGHT_MENS-T-SHIRT-BLACK-BACK",
    price: "$80.00",
    img: "assets/img/men/STARSHIPTESTFLIGHT_MENS-T-SHIRT-BLACK-BACK.jpg",
    size: "3X",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M23",
    title: "STICKER-PACK",
    price: "$25.00",
    img: "assets/img/men/STICKER-PACK-ALT1.jpg",
    size: "23.5x35.5",
    color: "grey",
    type: "poster",
  },
  {
    id: "M24",
    title: "UNISEX_DRAGON_ZIPPER_SMARTEX_GRAY_BACK",
    price: "$61.00",
    img: "assets/img/men/UNISEX_DRAGON_ZIPPER_SMARTEX_GRAY_BACK.jpg",
    size: "3X",
    color: "white",
    type: "tshirt",
  },
  {
    id: "M25",
    title: "UNISEX_F9_LS_T_SHIRT_BLACK_BACK",
    price: "$36.00",
    img: "assets/img/men/UNISEX_F9_LS_T_SHIRT_BLACK_BACK.jpg",
    size: "L",
    color: "black",
    type: "tshirt",
  },
  {
    id: "M26",
    title: "UNISEX_SPACEX_PULLOVER_BEIMAR_BLACK_BACK",
    price: "$56.00",
    img: "assets/img/men/UNISEX_SPACEX_PULLOVER_BEIMAR_BLACK_BACK.jpg",
    size: "M",
    color: "black",
    type: "tshirt",
  },
];

// Init
let itemsPerPage = 8;
let currentPage = 1;
let sortby = "name-asc";
let productType = "all";
let productColor = "all";
let productSize = "all";
let filteredProducts = [];
let filters = {};

// DOM Elements
const selectItemsPerPage = document.getElementById("items-per-page");
const productSelectElement = document.getElementById("product-type");
const productSizeSelectElement = document.getElementById("product-size");
const productColorElement = document.getElementById("product-color");
const noProducts = document.getElementById("no-products");
noProducts.style.display = "none";
const productsizes = {
  tshirt: ["All", "S", "M", "L", "2X", "2XL", "3X", "3XL"],
  hat: [],
  poster: ["All", "18x24", "23.5x35.5"],
  journal: ["All", "5.25x8.25"],
  bottle: ["All", "1L", "2L"],
  chain: [],
  cup: ["All", "15-oz", "20-oz"],
  all: [
    "All",
    "S",
    "M",
    "L",
    "2X",
    "2XL",
    "3X",
    "3XL",
    "18x24",
    "23.5x35.5",
    "5.25x8.25",
    "1L",
    "2L",
    "15-oz",
    "20-oz",
  ],
};

function displayProducts(productItemsArr) {
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const productListDiv = document.getElementById("product-list");
  productListDiv.innerHTML = "";
  for (let i = startIndex; i < endIndex && i < productItemsArr.length; i++) {
    const product = productItemsArr[i];
    const productDiv = document.createElement("div");
    productDiv.classList.add("col-lg-3", "col-md-4", "col-6");
    productDiv.innerHTML = `
            <a href="details.html?id=${product.id}&price=${product.price}&title=${product.title}&img=${product.img}" class="d-block">
                <img class="img-fluid"
                    src="${product.img}" alt="${product.title}" />
            </a>
            <div class="text-center mb-4 mt-3">
                <p>${product.title}</p>
                <p>${product.price}</p>
            </div>
            <ol class="carousel-indicators galleryIndicator">
                <li data-bs-target="#" data-bs-slide-to="0" class="active"></li>
                <li data-bs-target="#" data-bs-slide-to="1"></li>
                <li data-bs-target="#" data-bs-slide-to="2"></li>
            </ol>
        
    `;
    productListDiv.appendChild(productDiv);
  }
}

function displayPagination(productItemsArr) {
  const totalPages = Math.ceil(productItemsArr.length / itemsPerPage);
  const paginationDiv = document.getElementById("pagination");
  paginationDiv.innerHTML = "";
  for (let i = 1; i <= totalPages; i++) {
    const li = document.createElement("li");
    li.classList.add("page-item");
    const anchor = document.createElement("a");
    anchor.innerText = i;
    anchor.href = "#";
    anchor.classList.add("page-link");
    li.appendChild(anchor);
    if (i === currentPage) {
      li.disabled = true;
      li.classList.add("active");
    }
    li.addEventListener("click", () => {
      currentPage = i;
      displayProducts(productItemsArr);
      displayPagination(productItemsArr);
    });
    paginationDiv.appendChild(li);
  }
}

function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: "smooth",
  });
}

function sortProducts(sortBy, arr) {
  if (sortBy === "name-asc") {
    arr.sort(function (a, b) {
      const titleA = a.title.toUpperCase();
      const titleB = b.title.toUpperCase();
      if (titleA < titleB) {
        return -1;
      }
      if (titleA > titleB) {
        return 1;
      }
      return 0;
    });
    return arr;
  }
  if (sortBy === "name-desc") {
    arr.sort(function (a, b) {
      const titleA = a.title.toUpperCase();
      const titleB = b.title.toUpperCase();
      if (titleA < titleB) {
        return 1;
      }
      if (titleA > titleB) {
        return -1;
      }
      return 0;
    });
    return arr;
  }
  if (sortBy === "price-asc") {
    arr.sort((a, b) => {
      const priceA = Number(a.price.slice(1));
      const priceB = Number(b.price.slice(1));
      return priceA - priceB;
    });
    return arr;
  }
  if (sortBy === "price-desc") {
    arr.sort((a, b) => {
      const priceA = Number(a.price.slice(1));
      const priceB = Number(b.price.slice(1));
      return priceB - priceA;
    });
    return arr;
  }
}

// Function to filter products by price range
function filterByPrice(products, minPrice, maxPrice) {
  return products.filter((product) => {
    const removeDollarSign = product.price.replace(/\$/g, "");
    const productPrice = parseFloat(removeDollarSign);
    return productPrice >= minPrice && productPrice <= maxPrice;
  });
}

// Event Listener for items per page
selectItemsPerPage.addEventListener("change", (e) => {
  if (e.target.value === "") {
    return;
  }
  if (filteredProducts.length > 0) {
    itemsPerPage = Number(e.target.value);
    currentPage = 1;
    displayProducts(filteredProducts);
    displayPagination(filteredProducts);
    return;
  }
  itemsPerPage = Number(e.target.value);
  currentPage = 1;
  displayProducts(products);
  displayPagination(products);
});

// Event Listener for sort by
document.getElementById("sort-by").addEventListener("change", (e) => {
  sortby = e.target.value;
  if (filteredProducts.length > 0) {
    const sortedProducts = sortProducts(sortby, filteredProducts);
    filteredProducts = sortedProducts;
    displayProducts(filteredProducts);
    displayPagination(filteredProducts);
    return;
  }
  const sortedProducts = sortProducts(sortby, products);
  products = sortedProducts;
  displayProducts(products);
});

document.getElementById("product-type").addEventListener("change", (e) => {
  productType = e.target.value;
  delete filters.size;
  if (productType === "all") {
    delete filters.type;
    filteredItems(products);
    initProductSize();
    return;
  }
  filters.type = e.target.value;
  filteredItems(products);
  initProductSize();
});

document.getElementById("product-color").addEventListener("change", (e) => {
  productColor = e.target.value;
  if (productColor === "all") {
    delete filters.color;
    filteredItems(products);
    return;
  }
  filters.color = e.target.value;
  filteredItems(products);
});

document.getElementById("product-size").addEventListener("change", (e) => {
  productSize = e.target.value;
  if (productSize === "All") {
    delete filters.size;
    filteredItems(products);
    return;
  }
  filters.size = e.target.value;
  filteredItems(products);
});

// filter function that filters the products based on the filter params passed
function filteredItems(items) {
  const filteredItems = items.filter((product) => {
    for (let key in filters) {
      if (product[key] === undefined || product[key] != filters[key])
        return false;
    }
    return true;
  });
  filteredProducts = filteredItems;
  currentPage = 1;
  displayProducts(filteredItems);
  displayPagination(filteredItems);
  if (filteredProducts.length === 0) {
    noProducts.style.display = "block";
  } else {
    noProducts.style.display = "none";
  }
  return;
}

function initProductSize() {
  productSizeSelectElement.disabled = false;
  const selectedProduct = productSelectElement.value;
  const productSizes = productsizes[selectedProduct];
  if (productSizes.length > 1) {
    // Remove previous city options
    productSizeSelectElement.innerHTML = "";
    // Create new city options based on country
    productSizes.forEach((size) => {
      const option = document.createElement("option");
      option.value = size;
      option.textContent = size;
      productSizeSelectElement.appendChild(option);
    });
  } else {
    productSizeSelectElement.disabled = true;
  }
}

// Init Functions
sortProducts(sortby, products);
displayProducts(products);
displayPagination(products);
initProductSize();

// set default value as (0 - selected index) for the product type, color and size
window.addEventListener("load", function () {
  productSelectElement.selectedIndex = 0;
  productSizeSelectElement.selectedIndex = 0;
  productColorElement.selectedIndex = 0;
});
